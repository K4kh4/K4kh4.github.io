import{S as lt,C as B,F as ut,P as Pe,W as dt,a as ht,A as pt,b as ft,D as ue,c as Ge,T as mt,d as de,e as Fe,L as gt,f as Q,g as He,M as G,V as me,h as P,i as Z,j as At,k as ee,l as E,I as yt,Q as Be,m as bt,O as je,n as Tt,o as wt,B as ne,p as xt,q as Ue,N as Mt,r as Et,s as kt,t as Ke,u as vt,R as he,v as Rt,w as St,x as Lt,y as se,z as Ot,E as k,G as _t,H as V,J as It,K as Ct,U as Dt,X as M,Y as Nt,Z as Pt,_ as Gt,$ as Ft,a0 as L,a1 as Ht,a2 as Bt,a3 as jt,a4 as Ut,a5 as Kt,a6 as zt,a7 as ze,a8 as Vt,a9 as Me,aa as Ee,ab as ke,ac as ve,ad as Re,ae as Xt,af as $t,ag as Wt,ah as qt,ai as N,aj as Yt,ak as ie,al as Qt,am as Zt,an as Jt,ao as en,ap as tn}from"./three-B6cECddp.js";import{g as I}from"./gsap-C8pce-KX.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function nn(){const l=new lt;return l.background=new B(1184280),l.fog=new ut(1184280,8,20),l}function sn(){const l=new Pe(50,window.innerWidth/window.innerHeight,.1,100);return l.position.set(0,3,8),l.lookAt(0,1,0),l}function rn(){const l=new dt({antialias:!0,alpha:!1});return l.setSize(window.innerWidth,window.innerHeight),l.setPixelRatio(Math.min(window.devicePixelRatio,2)),l.shadowMap.enabled=!0,l.shadowMap.type=ht,l.toneMapping=pt,l.toneMappingExposure=1.2,l}function on(){const l=[],e=new ft(16777215,2.5);l.push(e);const t=new ue(16777215,1);t.position.set(5,8,5),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=.5,t.shadow.camera.far=20,t.shadow.camera.left=-10,t.shadow.camera.right=10,t.shadow.camera.top=10,t.shadow.camera.bottom=-10,l.push(t);const s=new ue(6724095,.3);s.position.set(-5,4,-3),l.push(s);const n=new Ge(65416,.5,10);return n.position.set(-2,2,3),l.push(n),l}function Se(l,e){if(e===mt)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),l;if(e===de||e===Fe){let t=l.getIndex();if(t===null){const r=[],a=l.getAttribute("position");if(a!==void 0){for(let o=0;o<a.count;o++)r.push(o);l.setIndex(r),t=l.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),l}const s=t.count-2,n=[];if(e===de)for(let r=1;r<=s;r++)n.push(t.getX(0)),n.push(t.getX(r)),n.push(t.getX(r+1));else for(let r=0;r<s;r++)r%2===0?(n.push(t.getX(r)),n.push(t.getX(r+1)),n.push(t.getX(r+2))):(n.push(t.getX(r+2)),n.push(t.getX(r+1)),n.push(t.getX(r)));n.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=l.clone();return i.setIndex(n),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),l}class an extends gt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new hn(t)}),this.register(function(t){return new wn(t)}),this.register(function(t){return new xn(t)}),this.register(function(t){return new Mn(t)}),this.register(function(t){return new fn(t)}),this.register(function(t){return new mn(t)}),this.register(function(t){return new gn(t)}),this.register(function(t){return new An(t)}),this.register(function(t){return new dn(t)}),this.register(function(t){return new yn(t)}),this.register(function(t){return new pn(t)}),this.register(function(t){return new Tn(t)}),this.register(function(t){return new bn(t)}),this.register(function(t){return new ln(t)}),this.register(function(t){return new En(t)}),this.register(function(t){return new kn(t)})}load(e,t,s,n){const i=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const c=Q.extractUrlBase(e);r=Q.resolveURL(c,this.path)}else r=Q.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),i.manager.itemError(e),i.manager.itemEnd(e)},o=new He(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(c){try{i.parse(c,r,function(d){t(d),i.manager.itemEnd(e)},a)}catch(d){a(d)}},s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let i;const r={},a={},o=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===Ve){try{r[y.KHR_BINARY_GLTF]=new vn(e)}catch(u){n&&n(u);return}i=JSON.parse(r[y.KHR_BINARY_GLTF].content)}else i=JSON.parse(o.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Hn(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const u=this.pluginCallbacks[d](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,r[u.name]=!0}if(i.extensionsUsed)for(let d=0;d<i.extensionsUsed.length;++d){const u=i.extensionsUsed[d],h=i.extensionsRequired||[];switch(u){case y.KHR_MATERIALS_UNLIT:r[u]=new un;break;case y.KHR_DRACO_MESH_COMPRESSION:r[u]=new Rn(i,this.dracoLoader);break;case y.KHR_TEXTURE_TRANSFORM:r[u]=new Sn;break;case y.KHR_MESH_QUANTIZATION:r[u]=new Ln;break;default:h.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(r),c.setPlugins(a),c.parse(s,n)}parseAsync(e,t){const s=this;return new Promise(function(n,i){s.parse(e,t,n,i)})}}function cn(){let l={};return{get:function(e){return l[e]},add:function(e,t){l[e]=t},remove:function(e){delete l[e]},removeAll:function(){l={}}}}const y={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ln{constructor(e){this.parser=e,this.name=y.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const i=t.json,o=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let c;const d=new B(16777215);o.color!==void 0&&d.setRGB(o.color[0],o.color[1],o.color[2],P);const u=o.range!==void 0?o.range:0;switch(o.type){case"directional":c=new ue(d),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Ge(d),c.distance=u;break;case"spot":c=new At(d),c.distance=u,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,c.angle=o.spot.outerConeAngle,c.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return c.position.set(0,0,0),c.decay=2,H(c,o),o.intensity!==void 0&&(c.intensity=o.intensity),c.name=t.createUniqueName(o.name||"light_"+e),n=Promise.resolve(c),t.cache.add(s,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(o){return s._getNodeRef(t.cache,a,o)})}}class un{constructor(){this.name=y.KHR_MATERIALS_UNLIT}getMaterialType(){return V}extendParams(e,t,s){const n=[];e.color=new B(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const r=i.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],P),e.opacity=r[3]}i.baseColorTexture!==void 0&&n.push(s.assignTexture(e,"map",i.baseColorTexture,Z))}return Promise.all(n)}}class dn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class hn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:G}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(i.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new me(a,a)}return Promise.all(i)}}class pn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:G}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(i)}}class fn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:G}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new B(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=n.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],P)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&i.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,Z)),r.sheenRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(i)}}class mn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:G}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&i.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(i)}}class gn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:G}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&i.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new B().setRGB(a[0],a[1],a[2],P),Promise.all(i)}}class An{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:G}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class yn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:G}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&i.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new B().setRGB(a[0],a[1],a[2],P),r.specularColorTexture!==void 0&&i.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,Z)),Promise.all(i)}}class bn{constructor(e){this.parser=e,this.name=y.EXT_MATERIALS_BUMP}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:G}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&i.push(s.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(i)}}class Tn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:G}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&i.push(s.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(i)}}class wn{constructor(e){this.parser=e,this.name=y.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,r)}}class xn{constructor(e){this.parser=e,this.name=y.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const r=i.extensions[t],a=n.images[r.source];let o=s.textureLoader;if(a.uri){const c=s.options.manager.getHandler(a.uri);c!==null&&(o=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,r.source,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Mn{constructor(e){this.parser=e,this.name=y.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const r=i.extensions[t],a=n.images[r.source];let o=s.textureLoader;if(a.uri){const c=s.options.manager.getHandler(a.uri);c!==null&&(o=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,r.source,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class En{constructor(e){this.name=y.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const n=s.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){const o=n.byteOffset||0,c=n.byteLength||0,d=n.count,u=n.byteStride,h=new Uint8Array(a,o,c);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(d,u,h,n.mode,n.filter).then(function(f){return f.buffer}):r.ready.then(function(){const f=new ArrayBuffer(d*u);return r.decodeGltfBuffer(new Uint8Array(f),d,u,h,n.mode,n.filter),f})})}else return null}}class kn{constructor(e){this.name=y.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const n=t.meshes[s.mesh];for(const c of n.primitives)if(c.mode!==O.TRIANGLES&&c.mode!==O.TRIANGLE_STRIP&&c.mode!==O.TRIANGLE_FAN&&c.mode!==void 0)return null;const r=s.extensions[this.name].attributes,a=[],o={};for(const c in r)a.push(this.parser.getDependency("accessor",r[c]).then(d=>(o[c]=d,o[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const d=c.pop(),u=d.isGroup?d.children:[d],h=c[0].count,f=[];for(const m of u){const T=new ee,g=new E,A=new Be,w=new E(1,1,1),x=new yt(m.geometry,m.material,h);for(let b=0;b<h;b++)o.TRANSLATION&&g.fromBufferAttribute(o.TRANSLATION,b),o.ROTATION&&A.fromBufferAttribute(o.ROTATION,b),o.SCALE&&w.fromBufferAttribute(o.SCALE,b),x.setMatrixAt(b,T.compose(g,A,w));for(const b in o)if(b==="_COLOR_0"){const R=o[b];x.instanceColor=new bt(R.array,R.itemSize,R.normalized)}else b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&m.geometry.setAttribute(b,o[b]);je.prototype.copy.call(x,m),this.parser.assignFinalMaterial(x),f.push(x)}return d.isGroup?(d.clear(),d.add(...f),d):f[0]}))}}const Ve="glTF",Y=12,Le={JSON:1313821514,BIN:5130562};class vn{constructor(e){this.name=y.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Y),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ve)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Y,i=new DataView(e,Y);let r=0;for(;r<n;){const a=i.getUint32(r,!0);r+=4;const o=i.getUint32(r,!0);if(r+=4,o===Le.JSON){const c=new Uint8Array(e,Y+r,a);this.content=s.decode(c)}else if(o===Le.BIN){const c=Y+r;this.body=e.slice(c,c+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Rn{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=y.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},o={},c={};for(const d in r){const u=pe[d]||d.toLowerCase();a[u]=r[d]}for(const d in e.attributes){const u=pe[d]||d.toLowerCase();if(r[d]!==void 0){const h=s.accessors[e.attributes[d]],f=X[h.componentType];c[u]=f.name,o[u]=h.normalized===!0}}return t.getDependency("bufferView",i).then(function(d){return new Promise(function(u,h){n.decodeDracoFile(d,function(f){for(const m in f.attributes){const T=f.attributes[m],g=o[m];g!==void 0&&(T.normalized=g)}u(f)},a,c,P,h)})})}}class Sn{constructor(){this.name=y.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Ln{constructor(){this.name=y.KHR_MESH_QUANTIZATION}}class Xe extends $t{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let r=0;r!==n;r++)t[r]=s[i+r];return t}interpolate_(e,t,s,n){const i=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=a*2,c=a*3,d=n-t,u=(s-t)/d,h=u*u,f=h*u,m=e*c,T=m-c,g=-2*f+3*h,A=f-h,w=1-g,x=A-h+u;for(let b=0;b!==a;b++){const R=r[T+b+a],C=r[T+b+o]*d,v=r[m+b+a],_=r[m+b]*d;i[b]=w*R+x*C+g*v+A*_}return i}}const On=new Be;class _n extends Xe{interpolate_(e,t,s,n){const i=super.interpolate_(e,t,s,n);return On.fromArray(i).normalize().toArray(i),i}}const O={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},X={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Oe={9728:vt,9729:Ke,9984:kt,9985:Et,9986:Mt,9987:Ue},_e={33071:St,33648:Rt,10497:he},re={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pe={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},F={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},In={CUBICSPLINE:void 0,LINEAR:ze,STEP:zt},oe={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Cn(l){return l.DefaultMaterial===void 0&&(l.DefaultMaterial=new k({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Xt})),l.DefaultMaterial}function U(l,e,t){for(const s in t.extensions)l[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function H(l,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(l.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Dn(l,e,t){let s=!1,n=!1,i=!1;for(let c=0,d=e.length;c<d;c++){const u=e[c];if(u.POSITION!==void 0&&(s=!0),u.NORMAL!==void 0&&(n=!0),u.COLOR_0!==void 0&&(i=!0),s&&n&&i)break}if(!s&&!n&&!i)return Promise.resolve(l);const r=[],a=[],o=[];for(let c=0,d=e.length;c<d;c++){const u=e[c];if(s){const h=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):l.attributes.position;r.push(h)}if(n){const h=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):l.attributes.normal;a.push(h)}if(i){const h=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):l.attributes.color;o.push(h)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(o)]).then(function(c){const d=c[0],u=c[1],h=c[2];return s&&(l.morphAttributes.position=d),n&&(l.morphAttributes.normal=u),i&&(l.morphAttributes.color=h),l.morphTargetsRelative=!0,l})}function Nn(l,e){if(l.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)l.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(l.morphTargetInfluences.length===t.length){l.morphTargetDictionary={};for(let s=0,n=t.length;s<n;s++)l.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Pn(l){let e;const t=l.extensions&&l.extensions[y.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+ae(t.attributes):e=l.indices+":"+ae(l.attributes)+":"+l.mode,l.targets!==void 0)for(let s=0,n=l.targets.length;s<n;s++)e+=":"+ae(l.targets[s]);return e}function ae(l){let e="";const t=Object.keys(l).sort();for(let s=0,n=t.length;s<n;s++)e+=t[s]+":"+l[t[s]]+";";return e}function fe(l){switch(l){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Gn(l){return l.search(/\.jpe?g($|\?)/i)>0||l.search(/^data\:image\/jpeg/)===0?"image/jpeg":l.search(/\.webp($|\?)/i)>0||l.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Fn=new ee;class Hn{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new cn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=!1,i=-1;typeof navigator<"u"&&(s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,i=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||s||n&&i<98?this.textureLoader=new Tt(this.options.manager):this.textureLoader=new wt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new He(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(r){const a={scene:r[0][n.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:n.asset,parser:s,userData:{}};return U(i,a,n),H(a,n),Promise.all(s._invokeAll(function(o){return o.afterRoot&&o.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const r=t[n].joints;for(let a=0,o=r.length;a<o;a++)e[r[a]].isBone=!0}for(let n=0,i=e.length;n<i;n++){const r=e[n];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(s[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),i=(r,a)=>{const o=this.associations.get(r);o!=null&&this.associations.set(a,o);for(const[c,d]of r.children.entries())i(d,a.children[c])};return i(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&s.push(i)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":n=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(i,r){return s.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[y.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(i,r){s.load(Q.resolveURL(t.uri,n.path),i,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const n=t.byteLength||0,i=t.byteOffset||0;return s.slice(i,i+n)})}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const r=re[n.type],a=X[n.componentType],o=n.normalized===!0,c=new a(n.count*r);return Promise.resolve(new ne(c,r,o))}const i=[];return n.bufferView!==void 0?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),n.sparse!==void 0&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(r){const a=r[0],o=re[n.type],c=X[n.componentType],d=c.BYTES_PER_ELEMENT,u=d*o,h=n.byteOffset||0,f=n.bufferView!==void 0?s.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let T,g;if(f&&f!==u){const A=Math.floor(h/f),w="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+A+":"+n.count;let x=t.cache.get(w);x||(T=new c(a,A*f,n.count*f/d),x=new xt(T,f/d),t.cache.add(w,x)),g=new Vt(x,o,h%f/d,m)}else a===null?T=new c(n.count*o):T=new c(a,h,n.count*o),g=new ne(T,o,m);if(n.sparse!==void 0){const A=re.SCALAR,w=X[n.sparse.indices.componentType],x=n.sparse.indices.byteOffset||0,b=n.sparse.values.byteOffset||0,R=new w(r[1],x,n.sparse.count*A),C=new c(r[2],b,n.sparse.count*o);a!==null&&(g=new ne(g.array.slice(),g.itemSize,g.normalized));for(let v=0,_=R.length;v<_;v++){const D=R[v];if(g.setX(D,C[v*o]),o>=2&&g.setY(D,C[v*o+1]),o>=3&&g.setZ(D,C[v*o+2]),o>=4&&g.setW(D,C[v*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,r=t.images[i];let a=this.textureLoader;if(r.uri){const o=s.manager.getHandler(r.uri);o!==null&&(a=o)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,s){const n=this,i=this.json,r=i.textures[e],a=i.images[t],o=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[o])return this.textureCache[o];const c=this.loadImageSource(t,s).then(function(d){d.flipY=!1,d.name=r.name||a.name||"",d.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(d.name=a.uri);const h=(i.samplers||{})[r.sampler]||{};return d.magFilter=Oe[h.magFilter]||Ke,d.minFilter=Oe[h.minFilter]||Ue,d.wrapS=_e[h.wrapS]||he,d.wrapT=_e[h.wrapT]||he,n.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[o]=c,c}loadImageSource(e,t){const s=this,n=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const r=n.images[e],a=self.URL||self.webkitURL;let o=r.uri||"",c=!1;if(r.bufferView!==void 0)o=s.getDependency("bufferView",r.bufferView).then(function(u){c=!0;const h=new Blob([u],{type:r.mimeType});return o=a.createObjectURL(h),o});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(o).then(function(u){return new Promise(function(h,f){let m=h;t.isImageBitmapLoader===!0&&(m=function(T){const g=new Me(T);g.needsUpdate=!0,h(g)}),t.load(Q.resolveURL(u,i.path),m,void 0,f)})}).then(function(u){return c===!0&&a.revokeObjectURL(o),u.userData.mimeType=r.mimeType||Gn(r.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),u});return this.sourceCache[e]=d,d}assignTexture(e,t,s,n){const i=this;return this.getDependency("texture",s.index).then(function(r){if(!r)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(r=r.clone(),r.channel=s.texCoord),i.extensions[y.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[y.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const o=i.associations.get(r);r=i.extensions[y.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),i.associations.set(r,o)}}return n!==void 0&&(r.colorSpace=n),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+s.uuid;let o=this.cache.get(a);o||(o=new Lt,se.prototype.copy.call(o,s),o.color.copy(s.color),o.map=s.map,o.sizeAttenuation=!1,this.cache.add(a,o)),s=o}else if(e.isLine){const a="LineBasicMaterial:"+s.uuid;let o=this.cache.get(a);o||(o=new Ot,se.prototype.copy.call(o,s),o.color.copy(s.color),o.map=s.map,this.cache.add(a,o)),s=o}if(n||i||r){let a="ClonedMaterial:"+s.uuid+":";n&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let o=this.cache.get(a);o||(o=s.clone(),i&&(o.vertexColors=!0),r&&(o.flatShading=!0),n&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(a,o),this.associations.set(o,this.associations.get(s))),s=o}e.material=s}getMaterialType(){return k}loadMaterial(e){const t=this,s=this.json,n=this.extensions,i=s.materials[e];let r;const a={},o=i.extensions||{},c=[];if(o[y.KHR_MATERIALS_UNLIT]){const u=n[y.KHR_MATERIALS_UNLIT];r=u.getMaterialType(),c.push(u.extendParams(a,i,t))}else{const u=i.pbrMetallicRoughness||{};if(a.color=new B(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const h=u.baseColorFactor;a.color.setRGB(h[0],h[1],h[2],P),a.opacity=h[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",u.baseColorTexture,Z)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),r=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}i.doubleSided===!0&&(a.side=_t);const d=i.alphaMode||oe.OPAQUE;if(d===oe.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===oe.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&r!==V&&(c.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new me(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;a.normalScale.set(u,u)}if(i.occlusionTexture!==void 0&&r!==V&&(c.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&r!==V){const u=i.emissiveFactor;a.emissive=new B().setRGB(u[0],u[1],u[2],P)}return i.emissiveTexture!==void 0&&r!==V&&c.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,Z)),Promise.all(c).then(function(){const u=new r(a);return i.name&&(u.name=i.name),H(u,i),t.associations.set(u,{materials:e}),i.extensions&&U(n,u,i),u})}createUniqueName(e){const t=It.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function i(a){return s[y.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(o){return Ie(o,a,t)})}const r=[];for(let a=0,o=e.length;a<o;a++){const c=e[a],d=Pn(c),u=n[d];if(u)r.push(u.promise);else{let h;c.extensions&&c.extensions[y.KHR_DRACO_MESH_COMPRESSION]?h=i(c):h=Ie(new Ct,c,t),n[d]={primitive:c,promise:h},r.push(h)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,n=this.extensions,i=s.meshes[e],r=i.primitives,a=[];for(let o=0,c=r.length;o<c;o++){const d=r[o].material===void 0?Cn(this.cache):this.getDependency("material",r[o].material);a.push(d)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(o){const c=o.slice(0,o.length-1),d=o[o.length-1],u=[];for(let f=0,m=d.length;f<m;f++){const T=d[f],g=r[f];let A;const w=c[f];if(g.mode===O.TRIANGLES||g.mode===O.TRIANGLE_STRIP||g.mode===O.TRIANGLE_FAN||g.mode===void 0)A=i.isSkinnedMesh===!0?new Dt(T,w):new M(T,w),A.isSkinnedMesh===!0&&A.normalizeSkinWeights(),g.mode===O.TRIANGLE_STRIP?A.geometry=Se(A.geometry,Fe):g.mode===O.TRIANGLE_FAN&&(A.geometry=Se(A.geometry,de));else if(g.mode===O.LINES)A=new Nt(T,w);else if(g.mode===O.LINE_STRIP)A=new Pt(T,w);else if(g.mode===O.LINE_LOOP)A=new Gt(T,w);else if(g.mode===O.POINTS)A=new Ft(T,w);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(A.geometry.morphAttributes).length>0&&Nn(A,i),A.name=t.createUniqueName(i.name||"mesh_"+e),H(A,i),g.extensions&&U(n,A,g),t.assignFinalMaterial(A),u.push(A)}for(let f=0,m=u.length;f<m;f++)t.associations.set(u[f],{meshes:e,primitives:f});if(u.length===1)return i.extensions&&U(n,u[0],i),u[0];const h=new L;i.extensions&&U(n,h,i),t.associations.set(h,{meshes:e});for(let f=0,m=u.length;f<m;f++)h.add(u[f]);return h})}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new Pe(Ht.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):s.type==="orthographic"&&(t=new Bt(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),H(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let n=0,i=t.joints.length;n<i;n++)s.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(n){const i=n.pop(),r=n,a=[],o=[];for(let c=0,d=r.length;c<d;c++){const u=r[c];if(u){a.push(u);const h=new ee;i!==null&&h.fromArray(i.array,c*16),o.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new jt(a,o)})}loadAnimation(e){const t=this.json,s=this,n=t.animations[e],i=n.name?n.name:"animation_"+e,r=[],a=[],o=[],c=[],d=[];for(let u=0,h=n.channels.length;u<h;u++){const f=n.channels[u],m=n.samplers[f.sampler],T=f.target,g=T.node,A=n.parameters!==void 0?n.parameters[m.input]:m.input,w=n.parameters!==void 0?n.parameters[m.output]:m.output;T.node!==void 0&&(r.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",A)),o.push(this.getDependency("accessor",w)),c.push(m),d.push(T))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(o),Promise.all(c),Promise.all(d)]).then(function(u){const h=u[0],f=u[1],m=u[2],T=u[3],g=u[4],A=[];for(let w=0,x=h.length;w<x;w++){const b=h[w],R=f[w],C=m[w],v=T[w],_=g[w];if(b===void 0)continue;b.updateMatrix&&b.updateMatrix();const D=s._createAnimationTracks(b,R,C,v,_);if(D)for(let $=0;$<D.length;$++)A.push(D[$])}return new Ut(i,void 0,A)})}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return n.mesh===void 0?null:s.getDependency("mesh",n.mesh).then(function(i){const r=s._getNodeRef(s.meshCache,n.mesh,i);return n.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let o=0,c=n.weights.length;o<c;o++)a.morphTargetInfluences[o]=n.weights[o]}),r})}loadNode(e){const t=this.json,s=this,n=t.nodes[e],i=s._loadNodeShallow(e),r=[],a=n.children||[];for(let c=0,d=a.length;c<d;c++)r.push(s.getDependency("node",a[c]));const o=n.skin===void 0?Promise.resolve(null):s.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),o]).then(function(c){const d=c[0],u=c[1],h=c[2];h!==null&&d.traverse(function(f){f.isSkinnedMesh&&f.bind(h,Fn)});for(let f=0,m=u.length;f<m;f++)d.add(u[f]);return d})}_loadNodeShallow(e){const t=this.json,s=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=t.nodes[e],r=i.name?n.createUniqueName(i.name):"",a=[],o=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return o&&a.push(o),i.camera!==void 0&&a.push(n.getDependency("camera",i.camera).then(function(c){return n._getNodeRef(n.cameraCache,i.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let d;if(i.isBone===!0?d=new Kt:c.length>1?d=new L:c.length===1?d=c[0]:d=new je,d!==c[0])for(let u=0,h=c.length;u<h;u++)d.add(c[u]);if(i.name&&(d.userData.name=i.name,d.name=r),H(d,i),i.extensions&&U(s,d,i),i.matrix!==void 0){const u=new ee;u.fromArray(i.matrix),d.applyMatrix4(u)}else i.translation!==void 0&&d.position.fromArray(i.translation),i.rotation!==void 0&&d.quaternion.fromArray(i.rotation),i.scale!==void 0&&d.scale.fromArray(i.scale);return n.associations.has(d)||n.associations.set(d,{}),n.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],n=this,i=new L;s.name&&(i.name=n.createUniqueName(s.name)),H(i,s),s.extensions&&U(t,i,s);const r=s.nodes||[],a=[];for(let o=0,c=r.length;o<c;o++)a.push(n.getDependency("node",r[o]));return Promise.all(a).then(function(o){for(let d=0,u=o.length;d<u;d++)i.add(o[d]);const c=d=>{const u=new Map;for(const[h,f]of n.associations)(h instanceof se||h instanceof Me)&&u.set(h,f);return d.traverse(h=>{const f=n.associations.get(h);f!=null&&u.set(h,f)}),u};return n.associations=c(i),i})}_createAnimationTracks(e,t,s,n,i){const r=[],a=e.name?e.name:e.uuid,o=[];F[i.path]===F.weights?e.traverse(function(h){h.morphTargetInfluences&&o.push(h.name?h.name:h.uuid)}):o.push(a);let c;switch(F[i.path]){case F.weights:c=ke;break;case F.rotation:c=ve;break;case F.position:case F.scale:c=Ee;break;default:switch(s.itemSize){case 1:c=ke;break;case 2:case 3:default:c=Ee;break}break}const d=n.interpolation!==void 0?In[n.interpolation]:ze,u=this._getArrayFromAccessor(s);for(let h=0,f=o.length;h<f;h++){const m=new c(o[h]+"."+F[i.path],t.array,u,d);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),r.push(m)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const s=fe(t.constructor),n=new Float32Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=t[i]*s;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(s){const n=this instanceof ve?_n:Xe;return new n(this.times,this.values,this.getValueSize()/3,s)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Bn(l,e,t){const s=e.attributes,n=new Wt;if(s.POSITION!==void 0){const a=t.json.accessors[s.POSITION],o=a.min,c=a.max;if(o!==void 0&&c!==void 0){if(n.set(new E(o[0],o[1],o[2]),new E(c[0],c[1],c[2])),a.normalized){const d=fe(X[a.componentType]);n.min.multiplyScalar(d),n.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const a=new E,o=new E;for(let c=0,d=i.length;c<d;c++){const u=i[c];if(u.POSITION!==void 0){const h=t.json.accessors[u.POSITION],f=h.min,m=h.max;if(f!==void 0&&m!==void 0){if(o.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),o.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),o.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),h.normalized){const T=fe(X[h.componentType]);o.multiplyScalar(T)}a.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}l.boundingBox=n;const r=new qt;n.getCenter(r.center),r.radius=n.min.distanceTo(n.max)/2,l.boundingSphere=r}function Ie(l,e,t){const s=e.attributes,n=[];function i(r,a){return t.getDependency("accessor",r).then(function(o){l.setAttribute(a,o)})}for(const r in s){const a=pe[r]||r.toLowerCase();a in l.attributes||n.push(i(s[r],a))}if(e.indices!==void 0&&!l.index){const r=t.getDependency("accessor",e.indices).then(function(a){l.setIndex(a)});n.push(r)}return Re.workingColorSpace!==P&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Re.workingColorSpace}" not supported.`),H(l,e),Bn(l,e,t),Promise.all(n).then(function(){return e.targets!==void 0?Dn(l,e.targets,t):l})}class jn{constructor(){this.loader=new an,this.interactiveObjects=[],this.clickableObjects=[],this.toggleObjects=[]}async load(e){try{const t=await this.loader.loadAsync(e),s=t.scene,n=this.categorizeObjects(s);return console.log("âœ… GLTF Scene loaded successfully"),console.log("ðŸ“¦ Interactive objects:",this.interactiveObjects.length),console.log("ðŸŽ¯ Clickable objects:",this.clickableObjects.length),{scene:s,...n,animations:t.animations||[]}}catch(t){throw console.error("âŒ Failed to load GLTF:",t),t}}categorizeObjects(e){const t={interactive:[],clickable:[],toggleable:[],all:[]};return e.traverse(s=>{if(!s.name)return;const n=s.name.toLowerCase(),i={originalName:s.name,id:this.getObjectId(s.name)};if(n.includes("interactive")&&(i.interactive=!0,i.hoverAnimation=!0,s.userData={...s.userData,...i},t.interactive.push(s),this.interactiveObjects.push(s)),n.includes("clickable")&&(i.clickable=!0,i.interactive=!0,s.userData={...s.userData,...i},t.clickable.push(s),this.clickableObjects.push(s)),(n.includes("toggle")||n.includes("desklight")||n.includes("light"))&&(i.toggleable=!0,i.clickable=!0,i.interactive=!0,i.isOn=!1,s.userData={...s.userData,...i},t.toggleable.push(s),this.toggleObjects.push(s)),n.includes("monitor"))s.userData={...s.userData,id:"monitor",interactive:!0,clickable:!0},t.clickable.push(s);else if(n.includes("phone"))s.userData={...s.userData,id:"phone",interactive:!0,clickable:!0},t.clickable.push(s);else if(n.includes("notebook"))s.userData={...s.userData,id:"notebook",interactive:!0,clickable:!0},t.clickable.push(s);else if(n.includes("poster")){const r=n.match(/poster[-_]?(\d+)/),a=r?`poster-${r[1]}`:"poster-1";s.userData={...s.userData,id:a,interactive:!0,clickable:!0},t.clickable.push(s)}else n.includes("keyboard")?(s.userData={...s.userData,id:"keyboard",interactive:!0,hoverAnimation:!0},t.interactive.push(s)):n.includes("mouse")&&!n.includes("pad")?(s.userData={...s.userData,id:"mouse",interactive:!0,hoverAnimation:!0},t.interactive.push(s)):(n.includes("macmini")||n.includes("mac"))&&(s.userData={...s.userData,id:"macmini",interactive:!0,hoverAnimation:!0},t.interactive.push(s));t.all.push(s)}),t.interactive=[...new Set(t.interactive)],t.clickable=[...new Set(t.clickable)],t.toggleable=[...new Set(t.toggleable)],t}getObjectId(e){return e.toLowerCase().replace(/interactive/gi,"").replace(/clickable/gi,"").replace(/toggle/gi,"").replace(/[_-]/g,"").trim()}setupShadows(e){e.traverse(t=>{t.isMesh&&(t.castShadow=!0,t.receiveShadow=!0)})}createPlaceholderScene(){const e=new L;e.name="DeskScene";const t=new N(6,.1,3),s=new k({color:4009764,roughness:.8,metalness:.1}),n=new M(t,s);n.position.y=0,n.receiveShadow=!0,n.name="Desk",e.add(n);const i=new Yt(20,20),r=new k({color:1710618,roughness:.9}),a=new M(i,r);a.rotation.x=-Math.PI/2,a.position.y=-.05,a.receiveShadow=!0,a.name="Floor",e.add(a);const o=new N(8,5,.2),c=new k({color:2763317,roughness:.9}),d=new M(o,c);d.position.set(0,2.5,-1.4),d.receiveShadow=!0,d.name="Wall",e.add(d);const u=new L;u.name="ClickableMonitor";const h=new N(1.2,.8,.05),f=new k({color:1710618}),m=new M(h,f);m.castShadow=!0;const T=new N(1.1,.7,.02),g=new k({color:1718874,emissive:662058,emissiveIntensity:.5}),A=new M(T,g);A.position.z=.025;const w=new ie(.05,.1,.3),x=new M(w,f);x.position.set(0,-.55,-.1),u.add(m),u.add(A),u.add(x),u.position.set(0,.5,-.3),u.userData={id:"monitor",clickable:!0,interactive:!0},e.add(u);const b=new L;b.name="InteractiveKeyboard";const R=new N(.8,.05,.4),C=new k({color:2763306}),v=new M(R,C);v.castShadow=!0,b.add(v),b.position.set(0,.08,.6),b.userData={id:"keyboard",interactive:!0,hoverAnimation:!0},e.add(b);const _=new L;_.name="InteractiveMouse";const D=new Qt(.04,.06,4,8),$=new k({color:1710618}),te=new M(D,$);te.rotation.z=Math.PI/2,te.castShadow=!0,_.add(te),_.position.set(.8,.08,.5),_.userData={id:"mouse",interactive:!0,hoverAnimation:!0},e.add(_);const K=new L;K.name="ClickablePhone";const We=new N(.15,.01,.3),qe=new k({color:1710618}),ge=new M(We,qe);ge.castShadow=!0;const Ye=new N(.14,.005,.28),Qe=new k({color:666186,emissive:662058,emissiveIntensity:.3}),Ae=new M(Ye,Qe);Ae.position.y=.01,K.add(ge),K.add(Ae),K.position.set(-1.5,.08,.3),K.userData={id:"phone",clickable:!0,interactive:!0},e.add(K);const z=new L;z.name="ClickableNotebook";const Ze=new N(.4,.02,.5),Je=new k({color:9127187}),ye=new M(Ze,Je);ye.castShadow=!0,z.add(ye),z.position.set(-1.8,.06,-.4),z.rotation.y=Math.PI/6,z.userData={id:"notebook",clickable:!0,interactive:!0},e.add(z);const W=new L;W.name="InteractiveMacMini";const et=new N(.3,.08,.3),tt=new k({color:13421772,metalness:.7,roughness:.3}),be=new M(et,tt);be.castShadow=!0,W.add(be),W.position.set(1.8,.09,-.5),W.userData={id:"macmini",interactive:!0,hoverAnimation:!0},e.add(W);const j=new L;j.name="ToggleDeskLight";const nt=new ie(.08,.08,.02),Te=new k({color:2763306}),st=new M(nt,Te),it=new ie(.02,.02,.6),we=new M(it,Te);we.position.y=.3;const rt=new Zt(.1,.15,8),ot=new k({color:2763306,emissive:0,emissiveIntensity:0}),J=new M(rt,ot);J.position.y=.65,J.rotation.x=Math.PI,J.name="LightHead",j.add(st),j.add(we),j.add(J),j.position.set(-2.3,.05,.8),j.userData={id:"desklight",toggleable:!0,clickable:!0,interactive:!0,isOn:!1},e.add(j);for(let S=1;S<=3;S++){const q=new L;q.name=`ClickablePoster${S}`;const at=new N(.6,.8,.02),ct=new k({color:[1718874,5904954,3824154][S-1]}),xe=new M(at,ct);xe.castShadow=!0,q.add(xe),q.position.set(-2.5+S*1.5,3,-1.3),q.userData={id:`poster-${S}`,clickable:!0,interactive:!0},e.add(q)}return console.log("ðŸ“¦ Created placeholder desk scene"),{scene:e,interactive:e.children.filter(S=>S.userData.interactive),clickable:e.children.filter(S=>S.userData.clickable),toggleable:e.children.filter(S=>S.userData.toggleable),all:e.children}}}class Ce{constructor(e,t,s,n=null){this.camera=e,this.renderer=t,this.scene=s,this.animationManager=n,this.raycaster=new Jt,this.interactiveObjects=[],this.clickableObjects=[],this.hoveredObject=null,this.outlineMaterial=null,this.init()}init(){this.outlineMaterial=new V({color:65416,side:en})}setInteractiveObjects(e){this.interactiveObjects=e.interactive||[],this.clickableObjects=e.clickable||[],console.log(`ðŸŽ¯ Set ${this.interactiveObjects.length} interactive and ${this.clickableObjects.length} clickable objects`)}update(e,t=!1){if(t){this.hoveredObject&&(this.handleHoverEnd(this.hoveredObject),this.hoveredObject=null);return}this.raycaster.setFromCamera(e,this.camera);const s=[...this.interactiveObjects,...this.clickableObjects].filter((i,r,a)=>a.indexOf(i)===r),n=this.raycaster.intersectObjects(s,!0);if(this.hoveredObject&&(this.handleHoverEnd(this.hoveredObject),this.hoveredObject=null),n.length>0){let i=n[0].object;for(;i.parent&&!i.userData.interactive&&!i.userData.clickable;)i=i.parent;(i.userData.interactive||i.userData.clickable)&&(this.hoveredObject=i,this.handleHoverStart(i))}}handleHoverStart(e){if(e.userData.clickable&&this.addOutline(e),e.userData.hoverAnimation&&this.animationManager){const t=this.getAnimationType(e);this.animationManager.playHoverAnimation(e,t)}document.body.style.cursor=e.userData.clickable?"pointer":"default"}handleHoverEnd(e){e.userData.clickable&&this.removeOutline(e),e.userData.hoverAnimation&&this.animationManager&&this.animationManager.stopHoverAnimation(e),document.body.style.cursor="default"}getAnimationType(e){const t=e.userData.id;return t==="keyboard"||t==="macmini"?"bounce":t==="mouse"?"move":"bounce"}addOutline(e){e.traverse(t=>{if(t.isMesh&&!t.userData.isOutline){t.userData.originalMaterial||(t.userData.originalMaterial=t.material);const s=t.geometry.clone(),n=new M(s,this.outlineMaterial);n.scale.multiplyScalar(1.05),n.userData.isOutline=!0,t.add(n)}})}removeOutline(e){e.traverse(t=>{t.isMesh&&t.children.filter(n=>n.userData.isOutline).forEach(n=>t.remove(n))})}getHoveredObject(){return this.hoveredObject}isClickable(e){return e&&e.userData.clickable}dispose(){this.interactiveObjects=[],this.clickableObjects=[],this.hoveredObject=null}}class Un{constructor(){this.activeAnimations=new Map,this.hoveredObjects=new Set}playHoverAnimation(e,t="bounce"){if(this.hoveredObjects.has(e))return;this.hoveredObjects.add(e);const s=`hover_${e.uuid}`;switch(e.userData.originalPosition||(e.userData.originalPosition=e.position.clone()),t){case"bounce":this.bounceAnimation(e,s);break;case"move":this.moveAnimation(e,s);break;case"scale":this.scaleAnimation(e,s);break;default:this.bounceAnimation(e,s)}}stopHoverAnimation(e){if(!this.hoveredObjects.has(e))return;this.hoveredObjects.delete(e);const t=`hover_${e.uuid}`;this.activeAnimations.has(t)&&(this.activeAnimations.get(t).kill(),this.activeAnimations.delete(t)),e.userData.originalPosition&&I.to(e.position,{x:e.userData.originalPosition.x,y:e.userData.originalPosition.y,z:e.userData.originalPosition.z,duration:.3,ease:"back.out(1.7)"}),I.to(e.scale,{x:1,y:1,z:1,duration:.3,ease:"back.out(1.7)"})}bounceAnimation(e,t){const s=I.timeline({repeat:-1,yoyo:!0});s.to(e.position,{y:e.userData.originalPosition.y+.1,duration:.6,ease:"back.out(1.7)"}),this.activeAnimations.set(t,s)}moveAnimation(e,t){const s=I.timeline({repeat:-1,yoyo:!0});s.to(e.position,{x:e.userData.originalPosition.x+.05,duration:.5,ease:"sine.inOut"}),this.activeAnimations.set(t,s)}scaleAnimation(e,t){const s=I.timeline();s.to(e.scale,{x:1.1,y:1.1,z:1.1,duration:.3,ease:"back.out(1.7)"}),this.activeAnimations.set(t,s)}toggleLight(e){const t=e.userData.isOn||!1;e.userData.isOn=!t;let s=null;return e.traverse(n=>{(n.name==="LightHead"||n.isMesh)&&(s=n)}),s&&s.material&&(t?(I.to(s.material,{emissiveIntensity:0,duration:.3}),I.to(s.material.emissive,{r:0,g:0,b:0,duration:.3})):(I.to(s.material,{emissiveIntensity:1,duration:.3}),I.to(s.material.emissive,{r:1,g:.8,b:.3,duration:.3}))),!t}dispose(){this.activeAnimations.forEach(e=>e.kill()),this.activeAnimations.clear(),this.hoveredObjects.clear()}}const De={monitor:{offset:new E(-2,.5,2.5),duration:1,ease:"power2.inOut"},phone:{offset:new E(-1.5,1,2),duration:1,ease:"power2.inOut"},notebook:{offset:new E(-1.5,1.5,2),duration:1,ease:"power2.inOut"},"poster-1":{offset:new E(-2,0,3.5),duration:1,ease:"power2.inOut"},"poster-2":{offset:new E(-2,0,3.5),duration:1,ease:"power2.inOut"},"poster-3":{offset:new E(-2,0,3.5),duration:1,ease:"power2.inOut"},desklight:{offset:new E(-1.5,1,2),duration:1,ease:"power2.inOut"},default:{offset:new E(-2,1,2.5),duration:1,ease:"power2.inOut"}};class Kn{constructor(e,t){this.camera=e,this.scene=t,this.defaultPosition=new E(0,2,4),this.defaultTarget=new E(0,1,0),this.currentTarget=this.defaultTarget.clone(),this.isZoomed=!1,this.focusedObject=null,this.animation=null}init(){this.camera.position.copy(this.defaultPosition),this.camera.lookAt(this.defaultTarget)}zoomToObject(e){if(!e)return;this.isZoomed=!0,this.focusedObject=e;const t=new E;e.getWorldPosition(t);const s=e.userData.id,n=De[s]||De.default,i=t.clone().add(n.offset),r=t.clone();return this.animation&&this.animation.kill(),this.animation=I.timeline({onUpdate:()=>{this.camera.lookAt(this.currentTarget)}}),this.animation.to(this.camera.position,{x:i.x,y:i.y,z:i.z,duration:n.duration,ease:n.ease},0),this.animation.to(this.currentTarget,{x:r.x,y:r.y,z:r.z,duration:n.duration,ease:n.ease},0),this.animation}resetCamera(){if(this.isZoomed)return this.isZoomed=!1,this.focusedObject=null,this.animation&&this.animation.kill(),this.animation=I.timeline({onUpdate:()=>{this.camera.lookAt(this.currentTarget)}}),this.animation.to(this.camera.position,{x:this.defaultPosition.x,y:this.defaultPosition.y,z:this.defaultPosition.z,duration:1,ease:"power2.inOut"},0),this.animation.to(this.currentTarget,{x:this.defaultTarget.x,y:this.defaultTarget.y,z:this.defaultTarget.z,duration:1,ease:"power2.inOut"},0),this.animation}update(e,t){if(this.isZoomed)return;const s=-e*.7,n=-t*.5;this.camera.position.x+=(s-this.camera.position.x+this.defaultPosition.x)*.05,this.camera.position.y+=(n-this.camera.position.y+this.defaultPosition.y)*.05,this.camera.lookAt(this.currentTarget)}onResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}getIsZoomed(){return this.isZoomed}getFocusedObject(){return this.focusedObject}}const zn={id:"monitor",category:"Web Games",title:"Web Games Portfolio",description:"My collection of browser-based games and interactive experiences",projects:[{id:"web-game-1",title:"Dash'n'Stash",description:"Loot, fight, and escape in a brand-new casual extraction shooter! Snatch gold, fend off real-time PvP attackers, and defend your base from ruthless raiders. Will you outsmart them all?",logo:"/assets/dns.webp",tags:["Unity","C#","Multiplayer","Casual","Extraction","Shooter"],link:"https://www.hyve.gg/game/dash-n-stash"},{id:"web-game-2",title:"BitByte",description:"Grow, outplay, and dominate in a high-stakes battles for real rewards. Follow our socials for upcoming pot announcements!",logo:"/assets/bb.webp",tags:["Unity","C#","Multiplayer","Battle Royale","PvP","Rewards"],link:"https://www.hyve.gg/game/bitbyte"},{id:"web-game-3",title:"Blasting Gumballs",description:"Blast gumballs to destroy donuts and maximize your score!.",logo:"/assets/bg.webp",tags:["Phaser","JavaScript","Arcade","High Score"],link:"https://www.hyve.gg/game/blasting-gumballs"},{id:"web-game-4",title:"We are Mafia",description:"Build your criminal empire and defend your turf in this strategic tower defense game!",logo:"/assets/wam.webp",tags:["Phaser","JavaScript","Tower Defense","Strategy"],link:"https://www.hyve.gg/game/we-are-mafia"}]},Vn={id:"phone",category:"Mobile Games",title:"Mobile Games Portfolio",description:"Touch-optimized games designed for iOS and Android platforms",projects:[{id:"mobile-game-1",title:"Synergy!",description:"Play through different Planets and defend the bases from the enemies! Swipe to roll and release to crouch to take advantage of the battle! Upgrade your Hero to get stronger and find cool Weapons and Gear!",logo:"/assets/synergy.webp",tags:["Unity","C#","PvE"],link:"https://apps.apple.com/game1",playStore:"https://apps.apple.com/mk/app/synergy/id1622045516"},{id:"mobile-game-2",title:"Match Mania",description:"Colorful match-3 puzzle game with over 500 levels, special power-ups, and daily challenges.",logo:"/assets/placeholder-mobile-2.png",tags:["Unity","C#","Match-3","Puzzle"],link:"https://apps.apple.com/game2",playStore:"https://play.google.com/store/game2"}]},Xn={id:"notebook",category:"Other Projects",title:"Creative Portfolio",description:"T-shirt designs, artwork, and other creative endeavors",projects:[{id:"tshirt-design-1",title:"Retro Gaming Collection",description:"Series of t-shirt designs inspired by classic 8-bit and 16-bit games. Each design captures the nostalgia of gaming's golden age.",logo:"/assets/placeholder-tshirt-1.png",tags:["Design","Illustration","Apparel","Gaming"],link:"https://shop.example.com/retro-gaming",images:["/assets/tshirt-1a.png","/assets/tshirt-1b.png"]},{id:"artwork-1",title:"Digital Art Portfolio",description:"Collection of digital illustrations, character designs, and concept art created for various projects.",logo:"/assets/placeholder-art-1.png",tags:["Digital Art","Illustration","Character Design"],link:"https://artstation.com/yourusername",images:["/assets/art-1a.png","/assets/art-1b.png"]},{id:"tshirt-design-2",title:"Minimalist Tech Series",description:"Clean, modern t-shirt designs featuring minimalist interpretations of technology and programming concepts.",logo:"/assets/placeholder-tshirt-2.png",tags:["Design","Minimalism","Tech","Apparel"],link:"https://shop.example.com/tech-series"}]},$n={id:"macmini",category:"About",title:"About My Setup",description:"The hardware that powers my creative work",interactive:"hover",hoverAnimation:"bounce"},Wn={id:"keyboard",category:"About",title:"Keyboard",description:"Mechanical keyboard for coding",interactive:"hover",hoverAnimation:"bounce"},qn={id:"mouse",category:"About",title:"Mouse",description:"Precision gaming mouse",interactive:"hover",hoverAnimation:"move"},Yn={id:"desklight",category:"Interactive",title:"Desk Light",description:"Click to toggle light",interactive:"toggle",clickable:!0},Qn={monitor:zn,phone:Vn,"poster-1":{id:"poster-1",category:"Steam Game",title:"Cyber Nexus",description:"A cyberpunk action RPG set in a dystopian future",projects:[{id:"steam-game-1",title:"Cyber Nexus",description:"Immerse yourself in a neon-lit cyberpunk world where you play as a rogue hacker fighting against corrupt corporations. Features deep RPG mechanics, branching storylines, and intense combat.",logo:"/assets/placeholder-steam-1.png",tags:["Unity","C#","RPG","Cyberpunk","Action"],link:"https://store.steampowered.com/app/game1",trailer:"https://youtube.com/watch?v=trailer1",releaseDate:"2024",features:["40+ hours of gameplay","Multiple endings based on choices","Advanced character customization","Real-time combat system","Original soundtrack"]}]},"poster-2":{id:"poster-2",category:"Steam Game",title:"Mystic Realms",description:"A fantasy adventure game with magic and exploration",projects:[{id:"steam-game-2",title:"Mystic Realms",description:"Embark on an epic fantasy journey through mystical lands filled with ancient magic, mysterious creatures, and forgotten legends. Master powerful spells and uncover the secrets of the realm.",logo:"/assets/placeholder-steam-2.png",tags:["Unreal Engine","C++","Fantasy","Adventure","Magic"],link:"https://store.steampowered.com/app/game2",trailer:"https://youtube.com/watch?v=trailer2",releaseDate:"2024",features:["Open world exploration","50+ unique spells","Dynamic weather system","Crafting and alchemy","Co-op multiplayer"]}]},"poster-3":{id:"poster-3",category:"Steam Game",title:"Void Station",description:"Survival horror in deep space",projects:[{id:"steam-game-3",title:"Void Station",description:"Experience terror in the void of space as you try to survive aboard an abandoned space station. Manage limited resources, solve environmental puzzles, and uncover the dark secrets that led to the station's downfall.",logo:"/assets/placeholder-steam-3.png",tags:["Unity","Horror","Survival","Sci-Fi","Atmospheric"],link:"https://store.steampowered.com/app/game3",trailer:"https://youtube.com/watch?v=trailer3",releaseDate:"2025",features:["Atmospheric horror experience","Resource management","Environmental storytelling","Multiple game endings","VR support"]}]},notebook:Xn,macmini:$n,keyboard:Wn,mouse:qn,desklight:Yn};class Zn{constructor(){this.tooltip=document.getElementById("tooltip"),this.modal=document.getElementById("modal"),this.modalBody=document.getElementById("modal-body"),this.prevButton=document.getElementById("modal-prev"),this.nextButton=document.getElementById("modal-next"),this.currentObjectId=null,this.clickableObjectIds=[],this.onNavigate=null}setClickableObjects(e){this.clickableObjectIds=e}setNavigationCallback(e){this.onNavigate=e,this.prevButton.addEventListener("click",()=>this.navigatePrevious()),this.nextButton.addEventListener("click",()=>this.navigateNext())}showTooltip(e,t,s){this.tooltip.textContent=`{${e}}`,this.tooltip.style.left=`${t}px`,this.tooltip.style.top=`${s}px`,this.tooltip.classList.add("visible")}hideTooltip(){this.tooltip.classList.remove("visible")}openModal(e){const t=Qn[e];if(!t){console.warn(`No data found for object: ${e}`);return}this.currentObjectId=e,this.updateNavigationButtons(),t.projects&&t.projects.length>0?this.renderProjectModal(t):this.renderInfoModal(t),this.modal.classList.add("active")}navigatePrevious(){const e=this.clickableObjectIds.indexOf(this.currentObjectId);if(e>0){const t=this.clickableObjectIds[e-1];this.onNavigate&&this.onNavigate(t)}}navigateNext(){const e=this.clickableObjectIds.indexOf(this.currentObjectId);if(e<this.clickableObjectIds.length-1){const t=this.clickableObjectIds[e+1];this.onNavigate&&this.onNavigate(t)}}updateNavigationButtons(){const e=this.clickableObjectIds.indexOf(this.currentObjectId);this.prevButton.disabled=e<=0,this.nextButton.disabled=e>=this.clickableObjectIds.length-1}renderProjectModal(e){let t=`
      <div class="modal-header">
        <h2 class="modal-title">${e.title}</h2>
        <p class="modal-subtitle">${e.description}</p>
      </div>
      <div class="modal-projects">
    `;e.projects.forEach(s=>{t+=`
        <div class="project-card">
          <div class="project-header">
            ${s.logo?`<img src="${s.logo}" alt="${s.title}" class="project-logo" onerror="this.style.display='none'">`:""}
            <h3 class="project-title">${s.title}</h3>
          </div>
          <p class="project-description">${s.description}</p>
          ${s.tags?`
            <div class="project-tags">
              ${s.tags.map(n=>`<span class="project-tag">${n}</span>`).join("")}
            </div>
          `:""}
          ${s.features?`
            <ul class="project-features">
              ${s.features.map(n=>`<li>${n}</li>`).join("")}
            </ul>
          `:""}
          <div class="project-links">
            ${s.link?`<a href="${s.link}" target="_blank" rel="noopener" class="project-link primary">View Project</a>`:""}
            ${s.github?`<a href="${s.github}" target="_blank" rel="noopener" class="project-link secondary">GitHub</a>`:""}
            ${s.playStore?`<a href="${s.playStore}" target="_blank" rel="noopener" class="project-link secondary">Play Store</a>`:""}
            ${s.trailer?`<a href="${s.trailer}" target="_blank" rel="noopener" class="project-link secondary">Watch Trailer</a>`:""}
          </div>
        </div>
      `}),t+="</div>",this.modalBody.innerHTML=t}renderInfoModal(e){let t=`
      <div class="modal-header">
        <h2 class="modal-title">${e.title}</h2>
        <p class="modal-description">${e.description}</p>
      </div>
    `;e.specs&&e.specs.length>0&&(t+='<ul class="modal-specs">',e.specs.forEach(s=>{t+=`<li><strong>${s.label}:</strong> <span>${s.value}</span></li>`}),t+="</ul>"),e.link&&(t+=`<a href="${e.link.url}" target="_blank" rel="noopener" class="modal-link">${e.link.text}</a>`),this.modalBody.innerHTML=t}closeModal(){this.modal.classList.remove("active"),this.currentObjectId=null,setTimeout(()=>{const e=this.modal.querySelector(".modal-body-wrapper");e&&(e.scrollTop=0)},300)}isModalOpen(){return this.modal.classList.contains("active")}}const Jn={name:"Default Theme",version:"1.0.0",description:"Default color scheme for the portfolio"},es={primary:{main:"#BE3D2A",rgb:"190, 61, 42",description:"Primary accent color - used for highlights, borders, and interactive elements"},secondary:{main:"#FFD460",rgb:"255, 212, 96",description:"Secondary accent color - used in gradients and secondary actions"},background:{main:"#0C2C55",dark:"#0C2C55",light:"#0C2C55",gradient:{start:"#0C2C55",end:"#0C2C55"},description:"Background colors for main scene and modals"},text:{primary:"#EDEDCE",secondary:"#EDEDCE",description:"Text colors for content"},ui:{dark:"#102E50",modalBorder:{color:"#BE3D2A",alpha:.3},modalShadow:{color:"#BE3D2A",alpha:.1},tooltip:{background:"rgba(0, 0, 0, 0.9)",border:"#BE3D2A"},button:{background:{alpha:.1},backgroundHover:{alpha:.2},border:{alpha:.3}},card:{background:{alpha:.02},backgroundHover:{alpha:.04},border:{alpha:.2},borderHover:{alpha:.4}},tag:{background:{alpha:.1},border:{alpha:.3}},scrollbar:{track:"rgba(255, 255, 255, 0.05)",thumb:"#BE3D2A",thumbHover:"#0066ff"},closeButton:{background:"rgba(255, 255, 255, 0.05)",backgroundHover:"rgba(255, 255, 255, 0.1)"},divider:"rgba(255, 255, 255, 0.1)",specItem:{background:"rgba(255, 255, 255, 0.03)"}},effects:{shadow:{modal:"-20px 0 60px rgba(0, 255, 136, 0.1)",button:"0 10px 20px rgba(0, 255, 136, 0.3)"},blur:"10px"}},ts={scene:{background:"#121218",fog:{color:"#121218",near:8,far:20}},objects:{outline:{color:"#BE3D2A",description:"Outline color for interactive objects on hover"}}},ce={theme:Jn,colors:es,threejs:ts};class ns{constructor(){this.colors=ce.colors,this.theme=ce.theme,this.root=document.documentElement}applyTheme(){this.root.style.setProperty("--color-primary",this.colors.primary.main),this.root.style.setProperty("--color-primary-rgb",this.colors.primary.rgb),this.root.style.setProperty("--color-secondary",this.colors.secondary.main),this.root.style.setProperty("--color-secondary-rgb",this.colors.secondary.rgb),this.root.style.setProperty("--color-bg",this.colors.background.main),this.root.style.setProperty("--color-bg-dark",this.colors.background.dark),this.root.style.setProperty("--color-bg-light",this.colors.background.light),this.root.style.setProperty("--color-bg-gradient-start",this.colors.background.gradient.start),this.root.style.setProperty("--color-bg-gradient-end",this.colors.background.gradient.end),this.root.style.setProperty("--color-dark",this.colors.ui.dark),this.root.style.setProperty("--color-text",this.colors.text.primary),this.root.style.setProperty("--color-text-secondary",this.colors.text.secondary),console.log(`âœ¨ Theme applied: ${this.theme.name} v${this.theme.version}`),console.log(`ðŸŽ¨ Primary: ${this.colors.primary.main}, Secondary: ${this.colors.secondary.main}`)}getColor(e){const t=e.split(".");let s=this.colors;for(const n of t)if(s=s[n],s===void 0)return null;return s}getRGBA(e,t=1){const s=this.getColor(`${e}.rgb`);return s?`rgba(${s}, ${t})`:null}updateColor(e,t){const s=e.split(".");let n=this.colors;for(let i=0;i<s.length-1;i++)n=n[s[i]];n[s[s.length-1]]=t,this.applyTheme()}getThemeInfo(){return this.theme}exportColors(){return JSON.stringify({theme:this.theme,colors:this.colors},null,2)}getThreeJSColors(){return ce.threejs}}const ss=new ns,p={scene:null,camera:null,renderer:null,cameraController:null,interactionManager:null,animationManager:null,uiManager:null,sceneLoader:null,clock:new tn,mouse:new me,deskObjects:null};async function is(){console.log("ðŸš€ Initializing K4kh4 Portfolio..."),ss.applyTheme(),p.scene=nn(),p.camera=sn(),p.renderer=rn(),document.getElementById("canvas-container").appendChild(p.renderer.domElement),on().forEach(t=>p.scene.add(t)),p.animationManager=new Un,p.cameraController=new Kn(p.camera,p.scene),p.uiManager=new Zn,p.sceneLoader=new jn,p.cameraController.init();try{console.log("ðŸ“¦ Loading desk scene from GLTF..."),p.deskObjects=await p.sceneLoader.load("/models/scene.glb"),p.scene.add(p.deskObjects.scene),p.sceneLoader.setupShadows(p.deskObjects.scene),p.interactionManager=new Ce(p.camera,p.renderer,p.scene,p.animationManager),p.interactionManager.setInteractiveObjects(p.deskObjects);const t=p.deskObjects.clickable.map(s=>s.userData.id).filter(Boolean);p.uiManager.setClickableObjects(t),p.uiManager.setNavigationCallback(s=>{Ne(s)}),console.log("âœ… Scene loaded successfully")}catch(t){console.error("âŒ Failed to load scene:",t),console.log("âš ï¸ Using placeholder scene as fallback"),p.deskObjects=p.sceneLoader.createPlaceholderScene(),p.scene.add(p.deskObjects.scene),p.interactionManager=new Ce(p.camera,p.renderer,p.scene,p.animationManager),p.interactionManager.setInteractiveObjects(p.deskObjects);const s=p.deskObjects.clickable.map(n=>n.userData.id).filter(Boolean);p.uiManager.setClickableObjects(s),p.uiManager.setNavigationCallback(n=>{Ne(n)})}rs(),setTimeout(()=>{document.getElementById("loading-screen").classList.add("hidden")},1e3),$e(),console.log("âœ¨ Portfolio initialized!")}function $e(){requestAnimationFrame($e),p.clock.getDelta(),p.cameraController.update(p.mouse.x,p.mouse.y);const l=p.uiManager.isModalOpen();p.interactionManager.update(p.mouse,l),p.renderer.render(p.scene,p.camera)}function rs(){window.addEventListener("mousemove",os),window.addEventListener("click",as),window.addEventListener("resize",ls),document.getElementById("modal-close").addEventListener("click",le),document.getElementById("modal").addEventListener("click",l=>{l.target.id==="modal"&&le()}),window.addEventListener("keydown",l=>{l.key==="Escape"&&le()})}function os(l){if(p.uiManager.isModalOpen()){p.uiManager.hideTooltip();return}p.mouse.x=l.clientX/window.innerWidth*2-1,p.mouse.y=-(l.clientY/window.innerHeight)*2+1;const e=p.interactionManager.getHoveredObject();if(e&&e.userData.clickable){const t=us(e);p.uiManager.showTooltip(t,l.clientX,l.clientY)}else p.uiManager.hideTooltip()}function as(){if(p.uiManager.isModalOpen())return;const l=p.interactionManager.getHoveredObject();if(!l){p.cameraController.getIsZoomed()&&(p.cameraController.resetCamera(),p.uiManager.closeModal());return}if(l.userData.toggleable){const e=p.animationManager.toggleLight(l);console.log(`ðŸ’¡ Light ${e?"ON":"OFF"}`);return}l.userData.clickable&&cs(l)}function cs(l){p.cameraController.zoomToObject(l),p.uiManager.openModal(l.userData.id)}function Ne(l){const e=p.deskObjects.clickable.find(t=>t.userData.id===l);e&&(p.cameraController.zoomToObject(e),p.uiManager.openModal(l))}function le(){p.uiManager.closeModal(),p.cameraController.getIsZoomed()&&p.cameraController.resetCamera()}function ls(){p.cameraController.onResize(),p.renderer.setSize(window.innerWidth,window.innerHeight)}function us(l){const e=l.userData.id;return{monitor:"Web Games",phone:"Mobile Games",notebook:"Other Projects","poster-1":"Cyber Nexus","poster-2":"Mystic Realms","poster-3":"Void Station",keyboard:"Keyboard",mouse:"Mouse",macmini:"Mac Mini",desklight:"Desk Light"}[e]||l.userData.originalName||e}is().catch(l=>{console.error("Failed to initialize application:",l),document.getElementById("loading-screen").querySelector(".loading-text").textContent="Failed to load. Please refresh the page."});
